<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">

.file-table th.sortable {
      cursor: pointer;
      user-select: none;
      position: relative;
      padding-right: 25px;
    }

    @media (min-width: 768px) {
      .file-table th.sortable {
        padding-right: 30px;
      }
    }

    .file-table th.sortable:hover {
      background: #e9ecef;
    }

    .sort-icon {
      position: absolute;
      right: 5px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: #6c757d;
    }

    @media (min-width: 768px) {
      .sort-icon {
        right: 10px;
        font-size: 12px;
      }
    }

    .sort-icon.active {
      color: #667eea;
    }<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>탑승구 안내방송 APP</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 10px;
    }

    @media (min-width: 768px) {
      body {
        padding: 20px;
      }
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      width: 40px;
    }

    .header-center {
      flex: 1;
      text-align: center;
    }

    .header-center h1 {
      font-size: 18px;
      font-weight: bold;
    }

    @media (min-width: 768px) {
      .header-center h1 {
        font-size: 24px;
      }
    }

    .header-right {
      width: 40px;
    }

    .icon-btn {
      background: rgba(255,255,255,0.2);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .icon-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }

    .icon-btn svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    .content {
      padding: 15px;
    }

    @media (min-width: 768px) {
      .content {
        padding: 30px;
      }
    }

    .upload-section {
      display: none;
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
      border: 2px dashed #667eea;
    }

    .upload-section.active {
      display: block;
    }

    .upload-area {
      text-align: center;
      padding: 30px;
    }

    .upload-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .upload-btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .upload-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    input[type="file"] {
      display: none;
    }

    .file-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 13px;
    }

    @media (min-width: 768px) {
      .file-table {
        font-size: 14px;
      }
    }

    /* 모바일에서 테이블 스크롤 가능하도록 */
    .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .file-table thead {
      background: #f8f9fa;
    }

    .file-table th {
      padding: 10px 8px;
      text-align: left;
      font-weight: 600;
      color: #495057;
      border-bottom: 2px solid #dee2e6;
      font-size: 12px;
    }

    @media (min-width: 768px) {
      .file-table th {
        padding: 15px;
        font-size: 14px;
      }
    }

    .file-table td {
      padding: 10px 8px;
      border-bottom: 1px solid #dee2e6;
      word-break: break-all;
      font-size: 12px;
    }

    @media (min-width: 768px) {
      .file-table td {
        padding: 15px;
        font-size: 14px;
      }
    }

    .file-table tr:hover {
      background: #f8f9fa;
    }

    .action-btn {
      background: none;
      border: none;
      padding: 6px 10px;
      margin: 2px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.3s;
      min-width: 60px;
      white-space: nowrap;
      display: inline-block;
    }

    @media (min-width: 768px) {
      .action-btn {
        padding: 8px 15px;
        margin: 3px;
        font-size: 14px;
        min-width: 80px;
      }
    }

    .play-btn {
      background: #28a745;
      color: white;
    }

    .pause-btn {
      background: #ffc107;
      color: white;
    }

    .delete-btn {
      background: #dc3545;
      color: white;
    }

    .action-btn:hover:not(:disabled) {
      opacity: 0.8;
      transform: translateY(-2px);
    }

    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .favorite-icon {
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s;
    }

    .favorite-icon:hover {
      transform: scale(1.2);
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #6c757d;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #6c757d;
    }

    .empty-state svg {
      width: 80px;
      height: 80px;
      fill: #dee2e6;
      margin-bottom: 20px;
    }

    .filter-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    @media (min-width: 768px) {
      .filter-tabs {
        gap: 10px;
      }
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 13px;
      flex: 1;
      min-width: 100px;
    }

    @media (min-width: 768px) {
      .filter-btn {
        padding: 10px 20px;
        font-size: 14px;
        flex: initial;
      }
    }

    .filter-btn.active {
      background: #667eea;
      color: white;
    }

    .status-message {
      margin-top: 15px;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
    }

    .status-info {
      background: #d1ecf1;
      color: #0c5460;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <div style="width: 40px;"></div>
      </div>
      <div class="header-center">
        <h1>Gate Announcement</h1>
      </div>
      <div class="header-right">
        <button class="icon-btn" id="uploadToggleBtn" title="파일 등록">
          <svg viewBox="0 0 24 24">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="white"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="content">
      <div class="upload-section" id="uploadSection">
        <div class="upload-area">
          <h3 style="margin-bottom: 15px;">음성 파일 업로드</h3>
          <p style="color: #6c757d; margin-bottom: 20px;">MP3, MP4 파일을 선택해주세요 (최대 7MB)</p>
          
          <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #495057;">Category 선택:</label>
            <div style="display: flex; gap: 15px; justify-content: center;">
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" name="category" value="Normal" checked style="margin-right: 5px;">
                <span>Normal</span>
              </label>
              <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="radio" name="category" value="Abnormal" style="margin-right: 5px;">
                <span>Abnormal</span>
              </label>
            </div>
          </div>
          
          <input type="file" id="fileInput" accept=".mp3,.mp4,audio/*,video/mp4">
          <button class="upload-btn" id="selectFileBtn">
            파일 선택
          </button>
          <div id="uploadStatus"></div>
        </div>
      </div>

      <div class="filter-tabs">
        <button class="filter-btn active" data-filter="Normal">Normal</button>
        <button class="filter-btn" data-filter="Abnormal">Abnormal</button>
      </div>

      <div id="fileListContainer">
        <div class="loading">Firebase 연결 중...</div>
      </div>
    </div>
  </div>

  <audio id="audioPlayer" style="display: none;"></audio>

  <!-- Firebase SDK v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <script>
  // Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyBQAfAx-K15PMqc-iACOwMINF2UN0MIG6Q",
  authDomain: "boarding-announcement.firebaseapp.com",
  databaseURL: "https://boarding-announcement-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "boarding-announcement",
  storageBucket: "boarding-announcement.firebasestorage.app",
  messagingSenderId: "1051789566065",
  appId: "1:1051789566065:web:b2d137fdd58593b7957bd0"
};

    // Firebase 초기화
    let database;
    let filesRef;
    let isFirebaseConnected = false;

    try {
      firebase.initializeApp(firebaseConfig);
      database = firebase.database();
      filesRef = database.ref('files');
      isFirebaseConnected = true;
      console.log('Firebase 연결 성공');
    } catch (error) {
      console.error('Firebase 초기화 실패:', error);
      document.getElementById('fileListContainer').innerHTML = 
        '<div class="empty-state"><p>Firebase 설정이 필요합니다.</p></div>';
    }

    let allFiles = [];
    let currentFilter = 'Normal';
    let currentPlayingId = null;
    let sortOrder = 'asc'; // 'asc' 또는 'desc'

    // 초기 로드
    window.onload = function() {
      if (isFirebaseConnected) {
        loadFiles();
      }
    };

    // 업로드 토글
    document.getElementById('uploadToggleBtn').addEventListener('click', function() {
      document.getElementById('uploadSection').classList.toggle('active');
    });

    // 필터 탭
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        currentFilter = this.dataset.filter;
        updateFilterButtons();
        renderFiles();
      });
    });

    function updateFilterButtons() {
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === currentFilter);
      });
    }

    // 파일 선택 버튼
    document.getElementById('selectFileBtn').addEventListener('click', function() {
      document.getElementById('fileInput').click();
    });

    // 파일 업로드
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      // 파일 크기 체크 (7MB)
      if (file.size > 7 * 1024 * 1024) {
        showStatus('파일 크기는 7MB 이하여야 합니다.', 'error');
        return;
      }

      // 선택된 카테고리 가져오기
      const category = document.querySelector('input[name="category"]:checked').value;

      const statusEl = document.getElementById('uploadStatus');
      const selectBtn = document.getElementById('selectFileBtn');
      
      statusEl.className = 'status-message status-info';
      statusEl.textContent = '업로드 중...';
      selectBtn.disabled = true;

      const reader = new FileReader();
      reader.onload = function(event) {
        try {
          // 오디오 duration 가져오기
          const audio = new Audio();
          audio.src = event.target.result;
          
          audio.onloadedmetadata = function() {
            const duration = Math.round(audio.duration);
            
            const fileData = {
              fileName: file.name,
              fileData: event.target.result,
              category: category,
              duration: duration,
              uploadDate: new Date().toISOString()
            };

            // Firebase에 저장
            filesRef.push(fileData).then(() => {
              statusEl.className = 'status-message status-success';
              statusEl.textContent = '업로드 완료!';
              
              setTimeout(() => {
                statusEl.textContent = '';
                statusEl.className = '';
                document.getElementById('uploadSection').classList.remove('active');
                e.target.value = '';
                selectBtn.disabled = false;
              }, 2000);
            }).catch(error => {
              console.error('업로드 실패:', error);
              statusEl.className = 'status-message status-error';
              statusEl.textContent = '업로드 실패: ' + error.message;
              selectBtn.disabled = false;
            });
          };
        } catch (error) {
          statusEl.className = 'status-message status-error';
          statusEl.textContent = '업로드 실패: ' + error.message;
          selectBtn.disabled = false;
        }
      };

      reader.onerror = function() {
        showStatus('파일을 읽을 수 없습니다.', 'error');
        selectBtn.disabled = false;
      };

      reader.readAsDataURL(file);
    });

    function showStatus(message, type) {
      const statusEl = document.getElementById('uploadStatus');
      statusEl.className = 'status-message status-' + type;
      statusEl.textContent = message;
      setTimeout(() => {
        statusEl.textContent = '';
        statusEl.className = '';
      }, 3000);
    }

    // Firebase에서 파일 로드
    function loadFiles() {
      filesRef.on('value', (snapshot) => {
        allFiles = [];
        snapshot.forEach((childSnapshot) => {
          const file = childSnapshot.val();
          file.id = childSnapshot.key;
          allFiles.push(file);
        });
        renderFiles();
      }, (error) => {
        console.error('파일 로드 실패:', error);
        document.getElementById('fileListContainer').innerHTML = 
          '<div class="empty-state"><p>파일을 불러올 수 없습니다.</p></div>';
      });
    }

    // 파일 목록 렌더링
    function renderFiles() {
      const container = document.getElementById('fileListContainer');
      
      let displayFiles = allFiles;
      if (currentFilter === 'Normal') {
        displayFiles = allFiles.filter(f => f.category === 'Normal');
      } else if (currentFilter === 'Abnormal') {
        displayFiles = allFiles.filter(f => f.category === 'Abnormal');
      }

      // 정렬 적용
      displayFiles.sort((a, b) => {
        const nameA = a.fileName.toLowerCase();
        const nameB = b.fileName.toLowerCase();
        if (sortOrder === 'asc') {
          return nameA.localeCompare(nameB);
        } else {
          return nameB.localeCompare(nameA);
        }
      });

      if (displayFiles.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <svg viewBox="0 0 24 24">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            <p>${currentFilter} 파일이 없습니다.<br>+ 버튼을 눌러 파일을 추가해주세요.</p>
          </div>
        `;
        return;
      }

      const sortIcon = sortOrder === 'asc' ? '▲' : '▼';

      let html = `
        <div class="table-wrapper">
        <table class="file-table">
          <thead>
            <tr>
              <th class="sortable" onclick="toggleSort()">
                Name
                <span class="sort-icon active">${sortIcon}</span>
              </th>
              <th width="90" style="text-align: center;">Duration</th>
              <th width="160" style="text-align: center;">Action</th>
            </tr>
          </thead>
          <tbody>
      `;

      displayFiles.forEach(file => {
        const duration = file.duration ? formatDuration(file.duration) : '--:--';
        html += `
          <tr>
            <td>${file.fileName}</td>
            <td style="text-align: center; padding: 10px;">${duration}</td>
            <td style="text-align: center; white-space: nowrap;">
              <button class="action-btn play-btn" id="btn-${file.id}" onclick="togglePlay('${file.id}')">
                Start
              </button>
              <button class="action-btn delete-btn" onclick="deleteFile('${file.id}')">
                Del
              </button>
            </td>
          </tr>
        `;
      });

      html += '</tbody></table></div>';
      container.innerHTML = html;
    }

    // 정렬 토글
    function toggleSort() {
      sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
      renderFiles();
    }

    // Duration 포맷팅 (초 -> MM:SS)
    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return mins + ':' + (secs < 10 ? '0' : '') + secs;
    }

    // 재생/일시정지 토글
    function togglePlay(fileId) {
      const audio = document.getElementById('audioPlayer');
      const btn = document.getElementById('btn-' + fileId);
      const file = allFiles.find(f => f.id === fileId);

      if (!file) {
        alert('파일을 찾을 수 없습니다.');
        return;
      }

      if (currentPlayingId === fileId && !audio.paused) {
        audio.pause();
        btn.textContent = 'Start';
        btn.classList.remove('pause-btn');
        btn.classList.add('play-btn');
      } else {
        if (currentPlayingId !== fileId) {
          if (currentPlayingId) {
            const prevBtn = document.getElementById('btn-' + currentPlayingId);
            if (prevBtn) {
              prevBtn.textContent = 'Start';
              prevBtn.classList.remove('pause-btn');
              prevBtn.classList.add('play-btn');
            }
          }

          audio.src = file.fileData;
          currentPlayingId = fileId;
        }

        audio.play().then(() => {
          btn.textContent = 'Pause';
          btn.classList.remove('play-btn');
          btn.classList.add('pause-btn');
        }).catch(error => {
          console.error('재생 오류:', error);
          alert('파일을 재생할 수 없습니다.');
        });
      }

      audio.onended = function() {
        btn.textContent = 'Start';
        btn.classList.remove('pause-btn');
        btn.classList.add('play-btn');
        currentPlayingId = null;
      };
    }

    // 파일 삭제
    function deleteFile(fileId) {
      const file = allFiles.find(f => f.id === fileId);
      const fileName = file ? file.fileName : 'this file';
      
      if (!confirm(`Delete "${fileName}"?\n\nThis action cannot be undone.`)) return;

      filesRef.child(fileId).remove().then(() => {
        if (currentPlayingId === fileId) {
          const audio = document.getElementById('audioPlayer');
          audio.pause();
          currentPlayingId = null;
        }
      }).catch(error => {
        console.error('삭제 실패:', error);
        alert('Delete failed: ' + error.message);
      });
    }

    // 즐겨찾기 토글 - 삭제됨 (더 이상 사용하지 않음)
  </script>
</body>
</html>
